# 第２４講

## 変数の使用

PHPに限らず、あらゆるプログラミング言語では変数が大事な役割を果たします。簡単な例をみてみましょう。ある人の名前を良く使わないといけないサイトがあるとします。

```php
<?php
print "ようこそ、しおんさん。<br>";
print "今日のしおんさんの予定は以下の通りです。<br><br><br><br>";
print "しおんさんへのメッセージが５件あります。<br>";
?>
```

とりあえず必要な情報は表示されていますが、もしこのサービスを他の人が使用したいときはどうしましょう？コピーを作って、名前のところを書き換えてもいいかもしれませんが、それは時間もかかるし、何より間違えて変え忘れたところなどがあると使用者は嫌な経験をするかもしれません。このように、同じデータが複数のところでたくさん使われるとき、変数を作ると便利です。上の例の名前のところを変数に変えると、

```php
<?php
$namae = "しおん";

print "ようこそ、$namae さん。<br>";
print "今日の$namae さんの予定は以下の通りです。<br><br><br><br>";
print "$namae さんへのメッセージが５件あります。<br>";
?>
```

こんな感じでコードを書き換えることができます！文字列の中に変数をそのまま入れることも可能です。このようにコードを書いておけば、名前を変更したいときは一箇所だけ変えることで、名前を書くところ全てに名前を埋めることができます。

もう一つ例を見てみましょう。二次方程式を解くコードを書いてみましょう。以下のような２次方程式をみてみましょう。

<img src="https://render.githubusercontent.com/render/math?math=x^2 %2B 6x - 7 = 0">

解の公式を使えば簡単ですね。

<img src="https://render.githubusercontent.com/render/math?math=\frac{-b \pm \sqrt{b^2 - 4ac} }{2a}">

```php
print "x^2 + 6x - 7 = 0 の解は ";
print (-6 + sqrt(6*6 - 4 * 1 * (-7))) / (2 * 1);
print " と ";
print (-6 - sqrt(6*6 - 4 * 1 * (-7))) / (2 * 1);
print " です。";
```

解けましたね！でもこれだと他の二次方程式を解きたいときに、数字一つ一つを入力し直す必要がありそうです…僕はミスを起こさずに毎回入力し直す自信はありません。というわけで、変数を使いましょう！

```php
$a = 1;
$b = 6; 
$c = -7; 

$bunbo = 2 * $a;
$bunsi1 = -$b + sqrt($b * $b - 4 * $a * $c);
$bunsi2 = -$b - sqrt($b * $b - 4 * $a * $c);

$kai1 = $bunsi1 / $bunbo;
$kai2 = $bunsi2 / $bunbo;

print "x^2 + 6x - 7 = 0 の解は ";
print $kai1;
print " と ";
print $kai2;
print " です。";
```

ちょっとコードは長くなったと感じるかもしれないけど、これで違う二次方程式を解きたいときは係数の$a, $b, $cだけ変更すれば自動的に解いてくれるプログラムが作れました！

こんな感じで変数を使うとコードを書く側は、重要な部分を一度だけ入力してすむようになり、手間も省けるしミスの可能性も大きく減ります！ミスがあるときも、一箇所だけ確認すれば直すことができるのでどんどん変数を駆使していきましょう。

それでは、練習問題を解いて理解を深めていきましょう！

## HTML と PHP 間のデータ共有

変数の使い方に慣れてきたところで、ある疑問が浮かんでいるかもしれません。練習問題では、変数を変更するたびにサイトを読み込み直す必要がありました。しかし、実際にインターネットを使っているときにはこちらの入力に合わせてサイトが動きます。ボタンをクリックしたり、ユーザ名を入力したり、色々なデータ入力の方法があります。ユーザに使ってもらう以上、このような入力に合わせてサイトを変更できる機能は実装していきたいですね。

次はこの入力の受け取り方を復習しましょう。

### form タグ

HTMLからPHPファイルにデータを送るときは、formタグを作る必要があります。（１９講参照）
```html
<form method="POST" action="ファイル名">
<input type="入力の種類" name="データの入れ物の名前" >
</form>
```

例を見た方がわかりやすいと思うので、いくつか見ていきましょう。

`okuri.html`
```html
<form method="POST" action="uke.php">
    <input type="text" name="okuri_data"> 
    <div>
        <input type="submit" name="SEND">
    </div>
</form>
```

`uke.php`
```php
<?php 
$uketa_data = $_POST["okuri_data"];

print $uketa_data;
?>
```

この「$_POST[]」変数を使えばformタグで送られてきたデータを取り出すことができます。受け取る「$_POST[]」変数の数が増えると見づらくなるので、すぐに自分がわかりやすい変数に格納してそちらを使いましょう。

## MySQL 

最後に、良く使うMySQLのコマンドをいくつか復習しましょう。

`新しいテーブルの作成`
```
CREATE TABLE テーブル名(カラム１名　カラム１型, カラム２名　カラム２型, ...);
```

`テーブルへデータを挿入する`
```
INSERT INTO テーブル名 VALUE (データ１, データ2, ...);
```

`テーブル内の指定したカラムへデータを挿入する`
```
INSERT INTO テーブル名(カラム名１, カラム名２, ...)  VALUE (データ１, データ2, ...);
```

`条件に一致するレコードを削除する`
```
DELETE FROM テーブル名 WHERE 条件;
```

現在作ってあるkeijiban_tbで試してみましょう。

## PHPでMySQLデータベースを操作する

これまでこのようなテンプレのコードを書いてきました。ポイントは、PDOと言ってPHPからデータベースを操作するための物を作成しているところです。このPDOオブジェクトに$dbhという名前をつけます。

```php
<?php
header('Content-Type: text/html;charset=utf-8');  // 日本語が正しく表示されるようにいれる
/* MySQLデータベース接続のための準備 */
$dsn = 'mysql:dbname=db1;host=localhost';
$user = 'root';
$password = 'password';

try {
    $dbh = new PDO($dsn, $user, $password);  // 新しいPDOを作成する
    /***

    ***/
} catch (PDOException $e) {
    echo 'Connection failed: ' . $e->getMessage();  // 接続が失敗したときにメッセージを表示する
}
?>
```

MySQLコマンドを使うためには上記の/*** ... ***/ の部分にコードを書いていきます。tryの括弧の中にコードを書くようにしましょう。

```php
$dbh->('クエリ文');
```

を使えば実行できます。これで問題なく使えるMySQLクエリはたくさんありますが、たまにSELECTのように返り値が大事なクエリ文もあります。こういうときは、変数に格納することでその変数を使用できます。

```php
$re = $dbh->('クエリ文');
```

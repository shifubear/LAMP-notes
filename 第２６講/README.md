# 第２６講

## MySQLとPHPの復習

MySQLのデータベースはたくさんのデータをまとめるのに便利なツールです。しかし、ユーザがサイトを使用するごとにエンジニアがそのユーザのデータを直接入力するのは到底無理です。そのためにサーバー側のプログラミング言語を使ってこの操作を自動化させます。その言語の代表例が今回使っているPHPです。

さて、ここまでPHPについて色々学んできましたが、今度はPHPを使ってMySQLを操作する方法を復習していきましょう。掲示板を作るのにも使用しているこのテンプレを見てましょう。

```php
<?php

...

$dsn      = 'mysql:dbname=db1;host=localhost';
$user     = 'root';
$password = 'password';

try {
    $dbh = new PDO($dsn, $user, $password);

    ...

    $dbh->query("____________________");

    ...

} catch (PDOException $e) {
    echo 'Connection failed: ' . $e->getMessage();
}
?>
```

PHPでMySQLの操作するに当たって最初に必要なのがPDOという種類のデータです。ここではPDOの中身については割愛しますが、これは「整数型」や「文字列型」のようなデータ型だと思ってください。

整数型のデータを作るときは、どの整数を入れるか明示する必要があります。また、文字列型もどの文字列が入っているのかを指定する必要があります。これと同じように、PDO型のデータも初期値が必要です。その初期値で必要なのが、データベースの場所と名前と種類、そしてログインするためのユーザ名とパスワードです。

上記のコードでは`$dsn`という変数の中にデータベースの場所（localhost)と種類（mysql)と名前(db1)を書いてます。さらに、`$user`, `$password`という変数にログインに必要な情報を変数に格納しました。

この三つの変数を使って新しいPDO型のデータを作成するコードが

```php
$dbh = new PDO($dsn, $user, $password);
```

です。このオブジェクトができれば、さまざまなSQLクエリを使ってMySQLのデータベースへアクセスすることができます。

### Try-Catch 文

ここでもう一つ気になるかもしれないところが`try`と`catch`と書いてある部分だと思います。これはPHPでよく使われる構文の一つなのでどのようなものなのかを確認しましょう。

PHPのコードを書いていると、エラーが起こった時にブラウザに何も表示されないことがあります。この時どこでエラーが起こったのかを知らないとコードを直すのは少し大変です。特に今回紹介してるPDOのような特殊なデータ型はエラーの種類が多くて、なんのエラーが起こっているかを特定することがとても大事です。そこで役にたつのがこの`try`と`catch`文です。

```php
try {
    // 実行するコード
} catch (エラーの種類 $エラー文字列の変数名) {
    // エラーが起こった時の処理
}
```

今回の授業ではPDOのエラーをキャッチするのが主な目的なので、細かいことはあまり気にしなくていいです。基本的にコードを書くときはこの`try-catch`文の上、または`try`の部分の中に書くようにしましょう。
